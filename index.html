<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inner Wealth</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', // Enable dark mode support
        }
    </script>
    
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX Transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        window.initializeApp = initializeApp;
        
        import { getAuth, signInAnonymously, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        window.firebaseAuth = { getAuth, signInAnonymously, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut };

        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, getDocs, where } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        window.firebaseFirestore = { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, getDocs, where };
    </script>

    <style>
        /* Basic styling to prevent layout shifts */
        body { font-family: sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- Import Libraries from Window Object ---
        const { useState, useEffect, useRef, createContext, useContext } = React;
        const { initializeApp } = window;
        const { getAuth, signInAnonymously, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } = window.firebaseAuth;
        const { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, getDocs, where } = window.firebaseFirestore;
        
        // --- Note: Recharts and Lucide-React are complex and not easily available via simple script tags for this kind of bundling.
        // --- For a real-world deployment, a build step (like Vite or Create React App) would be necessary.
        // --- As a placeholder, we'll create simple stand-ins for icons.

        const Icon = ({ name, size = 20 }) => <span style={{ fontSize: size }}>{name}</span>;
        const Sun = () => <Icon name="â˜€ï¸" />;
        const Moon = () => <Icon name="ðŸŒ™" />;
        const MessageSquare = () => <Icon name="ðŸ’¬" />;
        const Smile = () => <Icon name="ðŸ˜Š" />;
        const BarChart3 = () => <Icon name="ðŸ“Š" />;
        const LogOut = () => <Icon name="ðŸšª" />;
        const Send = () => <Icon name="âž¤" />;
        const Bot = () => <Icon name="ðŸ¤–" />;
        const User = () => <Icon name="ðŸ‘¤" />;
        const Award = () => <Icon name="ðŸ†" />;
        const Calendar = () => <Icon name="ðŸ—“ï¸" />;
        const BarChartHorizontal = () => <Icon name="ðŸ“ˆ" />;


        // --- Firebase Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : { apiKey: "YOUR_API_KEY", authDomain: "YOUR_AUTH_DOMAIN", projectId: "YOUR_PROJECT_ID" };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- App ID for Firestore Path ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-mental-health-app';

        // --- Theme Context for Dark Mode ---
        const ThemeContext = createContext();
        const ThemeProvider = ({ children }) => {
            const [theme, setTheme] = useState('light');
            
            const toggleTheme = () => {
                setTheme(prevTheme => (prevTheme === 'light' ? 'dark' : 'light'));
            };
            
            useEffect(() => {
                const root = document.documentElement;
                if (theme === 'dark') {
                    root.classList.add('dark');
                } else {
                    root.classList.remove('dark');
                }
            }, [theme]);

            return (
                <ThemeContext.Provider value={{ theme, toggleTheme }}>
                    {children}
                </ThemeContext.Provider>
            );
        };
        const useTheme = () => useContext(ThemeContext);

        // --- Theming & Constants ---
        const moodColors = {
            Happy: '#34d399', Good: '#60a5fa', Okay: '#fbbf24',
            Sad: '#c084fc', Awful: '#f87171', default: '#e5e7eb'
        };
        const activitiesList = [
            { id: 'exercise', label: 'Exercise', emoji: 'ðŸƒ' }, { id: 'meditate', label: 'Meditate', emoji: 'ðŸ§˜' },
            { id: 'socialize', label: 'Socialize', emoji: 'ðŸ’¬' }, { id: 'read', label: 'Read', emoji: 'ðŸ“–' },
            { id: 'work', label: 'Work', emoji: 'ðŸ’»' }, { id: 'relax', label: 'Relax', emoji: 'ðŸ˜Œ' },
        ];

        // --- Helper & Theming Components ---
        const AppHeader = ({ onSignOut }) => {
            const { theme, toggleTheme } = useTheme();
            return (
                <header className="bg-cyan-600 dark:bg-slate-800 text-white p-4 flex items-center justify-between shadow-md z-10 rounded-t-2xl">
                    <h1 className="text-xl sm:text-2xl font-bold">Inner Wealth</h1>
                    <div className="flex items-center gap-4">
                        <button onClick={toggleTheme} className="p-2 rounded-full hover:bg-white/20 transition-colors">
                            {theme === 'light' ? <Moon size={20} /> : <Sun size={20} />}
                        </button>
                        <button onClick={onSignOut} className="p-2 rounded-full hover:bg-white/20 transition-colors">
                            <LogOut size={20} />
                        </button>
                    </div>
                </header>
            );
        };

        const Message = ({ message }) => {
            const { text, sender } = message;
            const isUser = sender === 'user';
            if (isUser) {
                return (
                    <div className="flex items-start gap-3 justify-end">
                        <div className="bg-sky-500 text-white p-3 rounded-2xl shadow-sm max-w-xs md:max-w-md"><p className="text-sm">{text}</p></div>
                        <div className="bg-slate-200 dark:bg-slate-600 p-2 rounded-full flex-shrink-0"><User size={20} /></div>
                    </div>
                );
            }
            return (
                <div className="flex items-start gap-3">
                    <div className="bg-cyan-500 dark:bg-cyan-700 text-white p-2 rounded-full flex-shrink-0"><Bot size={20} /></div>
                    <div className="bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 p-3 rounded-2xl shadow-sm max-w-xs md:max-w-md"><p className="text-sm">{text}</p></div>
                </div>
            );
        };

        // --- Screen Components ---
        const AuthScreen = () => {
            const [error, setError] = useState(null);
            const handleGoogleSignIn = async () => { try { await signInWithPopup(auth, new GoogleAuthProvider()); } catch (e) { setError("Failed to sign in with Google."); } };
            const handleAnonymousSignIn = async () => { try { await signInAnonymously(auth); } catch (e) { setError("Failed to sign in anonymously."); } };
            
            return (
                <div className="w-full h-full flex flex-col items-center justify-end bg-slate-50 dark:bg-slate-900 rounded-2xl relative overflow-hidden">
                    <div className="absolute inset-0 w-full h-full z-0">
                        <img src="https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?q=80&w=2070&auto=format&fit=crop" alt="Calm sunset over a lake" className="w-full h-full object-cover"/>
                        <div className="absolute inset-0 bg-black/30"></div>
                    </div>
                    <div className="relative z-10 text-center p-8 w-full">
                        <h1 className="text-3xl font-bold text-white drop-shadow-lg">Welcome to Inner Wealth</h1>
                        <p className="text-slate-100 drop-shadow-md mt-2">Your personal space for reflection and support.</p>
                        <div className="mt-8 space-y-4 w-full max-w-xs mx-auto">
                            <button onClick={handleGoogleSignIn} className="w-full bg-sky-500 text-white py-3 rounded-xl font-semibold shadow-lg hover:bg-sky-600 transition-all">Sign in with Google</button>
                            <button onClick={handleAnonymousSignIn} className="w-full bg-slate-500 text-white py-3 rounded-xl font-semibold shadow-lg hover:bg-slate-600 transition-all">Continue Anonymously</button>
                        </div>
                        {error && <p className="text-rose-300 mt-4">{error}</p>}
                    </div>
                </div>
            );
        };

        const ChatScreen = () => {
            const [messages, setMessages] = useState([{ text: "Hey there! I'm here to listen. What's on your mind today?", sender: 'bot' }]);
            const [userInput, setUserInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const chatContainerRef = useRef(null);

            useEffect(() => { if (chatContainerRef.current) { chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight; } }, [messages, isLoading]);

            const handleSendMessage = async () => {
                const trimmedInput = userInput.trim();
                if (trimmedInput === '' || isLoading) return;
                setMessages(prev => [...prev, { text: trimmedInput, sender: 'user' }]);
                setUserInput('');
                setIsLoading(true);
                try {
                    const systemPrompt = `Act like a warm, friendly, and empathetic friend. Your tone should be informal and human-like, as if you're chatting with a close buddy. Use everyday language, be supportive, and listen without judgment. Offer gentle encouragement and maybe a simple mindfulness tip if it feels right. IMPORTANT: Always gently remind the user that you're an AI friend and not a substitute for a real therapist or doctor. If they seem to be in a tough spot, kindly suggest that talking to a professional or a crisis hotline might be a good idea. Keep it casual and caring. Now, respond to your friend's message:`;
                    const payload = { contents: [{ role: "user", parts: [{ text: `${systemPrompt} "${trimmedInput}"` }] }] };
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                    const result = await response.json();
                    const botResponseText = result.candidates?.[0]?.content?.parts?.[0]?.text || "I'm having a little trouble finding my words right now.";
                    setMessages(prev => [...prev, { text: botResponseText, sender: 'bot' }]);
                } catch (error) {
                    setMessages(prev => [...prev, { text: "Oops! There was a connection issue.", sender: 'bot' }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="flex flex-col h-full bg-slate-50 dark:bg-slate-900 relative">
                    <main ref={chatContainerRef} className="flex-1 p-4 sm:p-6 overflow-y-auto space-y-4 z-10">
                        {messages.map((msg, index) => <Message key={index} message={msg} />)}
                        {isLoading && <TypingIndicator />}
                    </main>
                    <footer className="p-4 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-t border-slate-200 dark:border-slate-700">
                        <div className="flex items-center space-x-2 sm:space-x-4">
                            <input type="text" value={userInput} onChange={(e) => setUserInput(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleSendMessage()} disabled={isLoading} className="flex-1 p-3 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white rounded-xl focus:ring-2 focus:ring-cyan-500 disabled:opacity-50" placeholder="You can talk to me..." />
                            <button onClick={handleSendMessage} disabled={isLoading} className="bg-cyan-600 hover:bg-cyan-700 text-white font-bold p-3 rounded-xl shadow-lg disabled:bg-cyan-400 transition-all"><Send size={20} /></button>
                        </div>
                    </footer>
                </div>
            );
        };

        const MoodTrackerScreen = ({ userId }) => {
            const moods = [ { label: 'Happy', emoji: 'ðŸ˜Š', value: 5 }, { label: 'Good', emoji: 'ï¿½', value: 4 }, { label: 'Okay', emoji: 'ðŸ˜', value: 3 }, { label: 'Sad', emoji: 'ðŸ˜Ÿ', value: 2 }, { label: 'Awful', emoji: 'ðŸ˜­', value: 1 }];
            const [selectedMood, setSelectedMood] = useState(null);
            const [selectedActivities, setSelectedActivities] = useState([]);
            const [journal, setJournal] = useState('');
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [message, setMessage] = useState('');
            const [hasCheckedInToday, setHasCheckedInToday] = useState(false);

            useEffect(() => {
                const checkTodaysEntry = async () => {
                    if (!userId) return;
                    const startOfDay = new Date(); startOfDay.setHours(0, 0, 0, 0);
                    const q = query(collection(db, `artifacts/${appId}/users/${userId}/moods`), where("timestamp", ">=", startOfDay));
                    const snapshot = await getDocs(q);
                    if (!snapshot.empty) {
                        setHasCheckedInToday(true);
                        setMessage("You've already checked in today. See you tomorrow!");
                    }
                };
                checkTodaysEntry();
            }, [userId]);

            const handleActivityToggle = (activityId) => setSelectedActivities(prev => prev.includes(activityId) ? prev.filter(id => id !== activityId) : [...prev, activityId]);
            
            const handleSubmit = async () => {
                if (!selectedMood) { setMessage('Please select a mood.'); return; }
                setIsSubmitting(true);
                try {
                    await addDoc(collection(db, `artifacts/${appId}/users/${userId}/moods`), { mood: selectedMood.label, moodValue: selectedMood.value, activities: selectedActivities, journal, timestamp: serverTimestamp() });
                    setMessage('Your entry has been saved. Thank you for checking in!');
                    setHasCheckedInToday(true);
                } catch (error) {
                    setMessage('There was an error saving your entry.');
                } finally {
                    setIsSubmitting(false);
                }
            };

            if (hasCheckedInToday) {
                return (
                    <div className="p-8 text-center bg-slate-50 dark:bg-slate-900 h-full flex flex-col justify-center items-center relative">
                        <h2 className="text-2xl font-bold text-slate-800 dark:text-slate-200 z-10">{message}</h2>
                    </div>
                );
            }

            return (
                <div className="p-4 sm:p-6 bg-slate-50 dark:bg-slate-900 h-full overflow-y-auto relative">
                    <div className="relative z-10">
                        <h2 className="text-2xl font-bold text-slate-800 dark:text-slate-200 text-center">How are you feeling today?</h2>
                        <div className="flex justify-center space-x-2 sm:space-x-4 my-6">
                            {moods.map(mood => <button key={mood.label} onClick={() => setSelectedMood(mood)} className={`p-3 rounded-full text-4xl transition transform hover:scale-110 ${selectedMood?.label === mood.label ? 'bg-cyan-200 dark:bg-cyan-800 ring-2 ring-cyan-500' : 'bg-white dark:bg-slate-800'}`}>{mood.emoji}</button>)}
                        </div>
                        <h3 className="text-lg font-semibold text-slate-800 dark:text-slate-300 mb-3 mt-6">What have you been up to?</h3>
                        <div className="flex flex-wrap gap-2 justify-center">
                            {activitiesList.map(act => <button key={act.id} onClick={() => handleActivityToggle(act.id)} className={`py-2 px-3 rounded-full text-sm transition-all ${selectedActivities.includes(act.id) ? 'bg-cyan-500 text-white' : 'bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300'}`}>{act.emoji} {act.label}</button>)}
                        </div>
                        <div className="mt-6">
                            <label htmlFor="journal" className="block text-lg font-semibold text-slate-800 dark:text-slate-300 mb-2">Add a journal entry (optional):</label>
                            <textarea id="journal" rows="4" value={journal} onChange={(e) => setJournal(e.target.value)} className="w-full p-3 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-800 dark:text-white rounded-xl focus:ring-2 focus:ring-cyan-500" placeholder="What's on your mind?"></textarea>
                        </div>
                        <div className="text-center mt-6">
                            <button onClick={handleSubmit} disabled={isSubmitting || !selectedMood} className="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg disabled:bg-cyan-400 transition-all">{isSubmitting ? 'Saving...' : 'Save Entry'}</button>
                            {message && <p className="mt-4 text-sm text-slate-600 dark:text-slate-400">{message}</p>}
                        </div>
                    </div>
                </div>
            );
        };

        const ProgressScreen = ({ userId }) => {
            return <div className="p-8 text-center dark:text-white">Progress Screen requires Recharts, which is not available in this bundled version.</div>
        };

        const MainApp = () => {
            const [user, setUser] = useState(null);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [activeTab, setActiveTab] = useState('chat');

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    setIsAuthReady(true);
                });
                return () => unsubscribe();
            }, []);

            const handleSignOut = async () => { try { await signOut(auth); } catch (error) { console.error("Sign out error", error); } };

            if (!isAuthReady) { return <div className="w-full h-screen flex items-center justify-center text-xl font-semibold text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-900">Loading...</div>; }

            return (
                <div className="bg-slate-200 dark:bg-slate-950 flex flex-col items-center justify-center min-h-screen p-2 sm:p-4">
                    <div className="w-full max-w-2xl bg-slate-50 dark:bg-slate-900 rounded-2xl shadow-2xl flex flex-col h-[95vh] sm:h-[90vh]">
                        {!user ? <AuthScreen /> : (
                            <>
                                <AppHeader onSignOut={handleSignOut} />
                                <div className="flex-grow overflow-hidden">
                                    {activeTab === 'chat' && <ChatScreen />}
                                    {activeTab === 'mood' && <MoodTrackerScreen userId={user.uid} />}
                                    {activeTab === 'progress' && <ProgressScreen userId={user.uid} />}
                                </div>
                                <nav className="flex justify-around p-2 border-t border-slate-200 dark:border-slate-700 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-b-2xl">
                                    <button onClick={() => setActiveTab('chat')} className={`p-3 rounded-xl transition-all ${activeTab === 'chat' ? 'text-cyan-600 dark:text-white bg-cyan-100 dark:bg-cyan-700' : 'text-slate-500 dark:text-slate-400'}`}><MessageSquare /></button>
                                    <button onClick={() => setActiveTab('mood')} className={`p-3 rounded-xl transition-all ${activeTab === 'mood' ? 'text-cyan-600 dark:text-white bg-cyan-100 dark:bg-cyan-700' : 'text-slate-500 dark:text-slate-400'}`}><Smile /></button>
                                    <button onClick={() => setActiveTab('progress')} className={`p-3 rounded-xl transition-all ${activeTab === 'progress' ? 'text-cyan-600 dark:text-white bg-cyan-100 dark:bg-cyan-700' : 'text-slate-500 dark:text-slate-400'}`}><BarChart3 /></button>
                                </nav>
                            </>
                        )}
                    </div>
                </div>
            );
        }

        const TypingIndicator = () => (
            <div className="flex items-start gap-3">
                <div className="bg-cyan-500 dark:bg-cyan-700 text-white p-2 rounded-full flex-shrink-0"><Bot size={20} /></div>
                <div className="bg-white dark:bg-slate-700 p-3 rounded-2xl shadow-sm"><div className="flex items-center space-x-1"><span className="w-2 h-2 bg-slate-400 rounded-full animate-pulse" style={{ animationDelay: '0s' }}></span><span className="w-2 h-2 bg-slate-400 rounded-full animate-pulse" style={{ animationDelay: '0.2s' }}></span><span className="w-2 h-2 bg-slate-400 rounded-full animate-pulse" style={{ animationDelay: '0.4s' }}></span></div></div>
            </div>
        );

        function App() {
            return (
                <ThemeProvider>
                    <MainApp />
                </ThemeProvider>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
ï¿½
